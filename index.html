<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <style type="text/css">
      code, pre {
        background-color: #6666;
        padding: 2px;
      }
      pre code {
        background-color: #0000;
        padding: 0px;
      }
    </style>
    <style type="text/css" media="(prefers-color-scheme: light)">
    </style>
    <style type="text/css" media="(prefers-color-scheme: dark)">
      body {background-color: black; color: white;}
      a {filter: invert(1) brightness(0.5) invert(1);}
      select, button {filter: invert(1);}
    </style>
    <style type="text/css" media="(prefers-color-scheme: never)">
      body {background-color: red;}
    </style>
    <script src="https://cdn.rawgit.com/showdownjs/showdown/1.9.1/dist/showdown.min.js"></script>
    <script>
      readme = 'README.md'
      converter = new showdown.Converter();
      html = converter.makeHtml('loading ``' + readme + '`` ...');

      function reqListener () {
        if ((this.status >= 200 && this.status < 300) || this.status == 304)  {
          html = converter.makeHtml(this.responseText);
        }else{
          html += "Status " + this.status;
          console.log(this);
        }
        document.getElementById('readme').innerHTML = html;
        document.title = document.getElementById('readme').children[0].innerText;
        if(location.href.split('#').length > 1){location.href=location.href}
      }

      cssAlwaysMedia = document.styleSheets[0].media;
      cssLightMedia = document.styleSheets[1].media;
      cssDarkMedia = document.styleSheets[2].media;
      cssNeverMedia = document.styleSheets[3].media;
      cssLight = document.styleSheets[1];
      cssDark = document.styleSheets[2];

      function toggleMenu () {
        miniMenuHTML = '<button style="float:right;" onclick="toggleMenu()">â˜°</button>';
        menuOptions = {'theme': {
          'auto': true, // default
          'dark': false,
          'light': false,
        }, 'text-width': {
          'full-width': true,
          'readable': false,
        }, 'font-family': {
          'serif': false,
          'sans-serif': true,
          'monospace': false,
        }};
        var mDiv = document.getElementById('indexmdmenu');
        if (mDiv.innerHTML == miniMenuHTML) {
          bigMenuHTML = miniMenuHTML;
          for (i in menuOptions){
            bigMenuHTML += '<select id="' + i + '"' + (i == Object.keys(menuOptions)[0] ? '' : ' style="width: 100%;"') + '>';
            for (j in menuOptions[i]) {
              bigMenuHTML += '<option value="' + j + '"' + (menuOptions[i][j] ? ' selected' : '') + '>' + j + '</option>';
            }
            bigMenuHTML += '</select><br />';
          }
          mDiv.innerHTML = bigMenuHTML;
        }else{
          mDiv.innerHTML = miniMenuHTML;
        }
      }

      function menuEffect() {
        theme = document.getElementById('theme').selectedOptions[0].innerText;
        switch (theme) {
          case 'dark':
            cssDark.media = cssAlwaysMedia;
            cssLight.media = cssNeverMedia;
            break;
          case 'light':
            cssDark.media = cssNeverMedia;
            cssLight.media = cssAlwaysMedia;
            break;
          default:
            cssDark.media = cssDarkMedia;
            cssLight.media = cssLightMedia;
        }
        textWidth = document.getElementById('text-width').selectedOptions[0].innerText;
        switch (textWidth) {
          case 'readable':
            document.body.style.maxWidth="70ch";
            break;
          default:
            document.body.style.maxWidth="";
        }
        fontFamily = document.getElementById('font-family').selectedOptions[0].innerText;
        document.body.style.fontFamily=fontFamily;
      }

      function main() {
        toggleMenu();
        oReq = new XMLHttpRequest();
        oReq.addEventListener("load", reqListener);
        oReq.open("GET", readme);
        oReq.send();
      }
    </script>
	</head>
  <body onload="main()">
    <div id="indexmdmenu" style="float:right; max-width: 30vw; border: dotted" onchange="menuEffect()"></div>
    <div id="readme"></div>
	</body>
</html>

